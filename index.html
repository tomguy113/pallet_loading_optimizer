<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Âè∞ÁÅ£ËªäÂûãÈÅ∏ÊìáË®àÁÆóÂô® - Ê£ßÊùøÈÖçÁΩÆËàáÊàêÊú¨ÊúÄ‰Ω≥Âåñ</title>
    
    <style>
        :root {
          /* Colors */
          --color-background: rgba(252, 252, 249, 1);
          --color-surface: rgba(255, 255, 253, 1);
          --color-text: rgba(19, 52, 59, 1);
          --color-text-secondary: rgba(98, 108, 113, 1);
          --color-primary: rgba(33, 128, 141, 1);
          --color-primary-hover: rgba(29, 116, 128, 1);
          --color-primary-active: rgba(26, 104, 115, 1);
          --color-secondary: rgba(94, 82, 64, 0.12);
          --color-secondary-hover: rgba(94, 82, 64, 0.2);
          --color-secondary-active: rgba(94, 82, 64, 0.25);
          --color-border: rgba(94, 82, 64, 0.2);
          --color-btn-primary-text: rgba(252, 252, 249, 1);
          --color-card-border: rgba(94, 82, 64, 0.12);
          --color-card-border-inner: rgba(94, 82, 64, 0.12);
          --color-error: rgba(192, 21, 47, 1);
          --color-success: rgba(33, 128, 141, 1);
          --color-warning: rgba(168, 75, 47, 1);
          --color-info: rgba(98, 108, 113, 1);
          --color-focus-ring: rgba(33, 128, 141, 0.4);
          --color-select-caret: rgba(19, 52, 59, 0.8);
        
          /* Common style patterns */
          --focus-ring: 0 0 0 3px var(--color-focus-ring);
          --focus-outline: 2px solid var(--color-primary);
          --status-bg-opacity: 0.15;
          --status-border-opacity: 0.25;
          --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
          --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        
          /* RGB versions for opacity control */
          --color-success-rgb: 33, 128, 141;
          --color-error-rgb: 192, 21, 47;
          --color-warning-rgb: 168, 75, 47;
          --color-info-rgb: 98, 108, 113;
        
          /* Typography */
          --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
            BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
          --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
            Monaco, Consolas, monospace;
          --font-size-xs: 11px;
          --font-size-sm: 12px;
          --font-size-base: 14px;
          --font-size-md: 14px;
          --font-size-lg: 16px;
          --font-size-xl: 18px;
          --font-size-2xl: 20px;
          --font-size-3xl: 24px;
          --font-size-4xl: 30px;
          --font-weight-normal: 400;
          --font-weight-medium: 500;
          --font-weight-semibold: 550;
          --font-weight-bold: 600;
          --line-height-tight: 1.2;
          --line-height-normal: 1.5;
          --letter-spacing-tight: -0.01em;
        
          /* Spacing */
          --space-0: 0;
          --space-1: 1px;
          --space-2: 2px;
          --space-4: 4px;
          --space-6: 6px;
          --space-8: 8px;
          --space-10: 10px;
          --space-12: 12px;
          --space-16: 16px;
          --space-20: 20px;
          --space-24: 24px;
          --space-32: 32px;
        
          /* Border Radius */
          --radius-sm: 6px;
          --radius-base: 8px;
          --radius-md: 10px;
          --radius-lg: 12px;
          --radius-full: 9999px;
        
          /* Shadows */
          --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
          --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
          --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
            0 2px 4px -1px rgba(0, 0, 0, 0.02);
          --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
            0 4px 6px -2px rgba(0, 0, 0, 0.02);
          --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15),
            inset 0 -1px 0 rgba(0, 0, 0, 0.03);
        
          /* Animation */
          --duration-fast: 150ms;
          --duration-normal: 250ms;
          --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);
        
          /* Layout */
          --container-sm: 640px;
          --container-md: 768px;
          --container-lg: 1024px;
          --container-xl: 1280px;
        }
        
        /* Dark mode colors */
        @media (prefers-color-scheme: dark) {
          :root {
            --color-background: rgba(31, 33, 33, 1);
            --color-surface: rgba(38, 40, 40, 1);
            --color-text: rgba(245, 245, 245, 1);
            --color-text-secondary: rgba(167, 169, 169, 0.7);
            --color-primary: rgba(50, 184, 198, 1);
            --color-primary-hover: rgba(45, 166, 178, 1);
            --color-primary-active: rgba(41, 150, 161, 1);
            --color-secondary: rgba(119, 124, 124, 0.15);
            --color-secondary-hover: rgba(119, 124, 124, 0.25);
            --color-secondary-active: rgba(119, 124, 124, 0.3);
            --color-border: rgba(119, 124, 124, 0.3);
            --color-error: rgba(255, 84, 89, 1);
            --color-success: rgba(50, 184, 198, 1);
            --color-warning: rgba(230, 129, 97, 1);
            --color-info: rgba(167, 169, 169, 1);
            --color-focus-ring: rgba(50, 184, 198, 0.4);
            --color-btn-primary-text: rgba(19, 52, 59, 1);
            --color-card-border: rgba(119, 124, 124, 0.2);
            --color-card-border-inner: rgba(119, 124, 124, 0.15);
            --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
              inset 0 -1px 0 rgba(0, 0, 0, 0.15);
            --button-border-secondary: rgba(119, 124, 124, 0.2);
            --color-border-secondary: rgba(119, 124, 124, 0.2);
            --color-select-caret: rgba(245, 245, 245, 0.8);
        
            /* Common style patterns - updated for dark mode */
            --focus-ring: 0 0 0 3px var(--color-focus-ring);
            --focus-outline: 2px solid var(--color-primary);
            --status-bg-opacity: 0.15;
            --status-border-opacity: 0.25;
            --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        
            /* RGB versions for dark mode */
            --color-success-rgb: 50, 184, 198;
            --color-error-rgb: 255, 84, 89;
            --color-warning-rgb: 230, 129, 97;
            --color-info-rgb: 167, 169, 169;
          }
        }
        
        /* Data attribute for manual theme switching */
        [data-color-scheme="dark"] {
          --color-background: rgba(31, 33, 33, 1);
          --color-surface: rgba(38, 40, 40, 1);
          --color-text: rgba(245, 245, 245, 1);
          --color-text-secondary: rgba(167, 169, 169, 0.7);
          --color-primary: rgba(50, 184, 198, 1);
          --color-primary-hover: rgba(45, 166, 178, 1);
          --color-primary-active: rgba(41, 150, 161, 1);
          --color-secondary: rgba(119, 124, 124, 0.15);
          --color-secondary-hover: rgba(119, 124, 124, 0.25);
          --color-secondary-active: rgba(119, 124, 124, 0.3);
          --color-border: rgba(119, 124, 124, 0.3);
          --color-error: rgba(255, 84, 89, 1);
          --color-success: rgba(50, 184, 198, 1);
          --color-warning: rgba(230, 129, 97, 1);
          --color-info: rgba(167, 169, 169, 1);
          --color-focus-ring: rgba(50, 184, 198, 0.4);
          --color-btn-primary-text: rgba(19, 52, 59, 1);
          --color-card-border: rgba(119, 124, 124, 0.15);
          --color-card-border-inner: rgba(119, 124, 124, 0.15);
          --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
            inset 0 -1px 0 rgba(0, 0, 0, 0.15);
          --color-border-secondary: rgba(119, 124, 124, 0.2);
          --color-select-caret: rgba(245, 245, 245, 0.8);
        
          /* Common style patterns - updated for dark mode */
          --focus-ring: 0 0 0 3px var(--color-focus-ring);
          --focus-outline: 2px solid var(--color-primary);
          --status-bg-opacity: 0.15;
          --status-border-opacity: 0.25;
          --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
          --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        
          /* RGB versions for dark mode */
          --color-success-rgb: 50, 184, 198;
          --color-error-rgb: 255, 84, 89;
          --color-warning-rgb: 230, 129, 97;
          --color-info-rgb: 167, 169, 169;
        }
        
        [data-color-scheme="light"] {
          --color-background: rgba(252, 252, 249, 1);
          --color-surface: rgba(255, 255, 253, 1);
          --color-text: rgba(19, 52, 59, 1);
          --color-text-secondary: rgba(98, 108, 113, 1);
          --color-primary: rgba(33, 128, 141, 1);
          --color-primary-hover: rgba(29, 116, 128, 1);
          --color-primary-active: rgba(26, 104, 115, 1);
          --color-secondary: rgba(94, 82, 64, 0.12);
          --color-secondary-hover: rgba(94, 82, 64, 0.2);
          --color-secondary-active: rgba(94, 82, 64, 0.25);
          --color-border: rgba(94, 82, 64, 0.2);
          --color-btn-primary-text: rgba(252, 252, 249, 1);
          --color-card-border: rgba(94, 82, 64, 0.12);
          --color-card-border-inner: rgba(94, 82, 64, 0.12);
          --color-error: rgba(192, 21, 47, 1);
          --color-success: rgba(33, 128, 141, 1);
          --color-warning: rgba(168, 75, 47, 1);
          --color-info: rgba(98, 108, 113, 1);
          --color-focus-ring: rgba(33, 128, 141, 0.4);
        
          /* RGB versions for light mode */
          --color-success-rgb: 33, 128, 141;
          --color-error-rgb: 192, 21, 47;
          --color-warning-rgb: 168, 75, 47;
          --color-info-rgb: 98, 108, 113;
        }
        
        /* Base styles */
        html {
          font-size: var(--font-size-base);
          font-family: var(--font-family-base);
          line-height: var(--line-height-normal);
          color: var(--color-text);
          background-color: var(--color-background);
          -webkit-font-smoothing: antialiased;
          box-sizing: border-box;
        }
        
        body {
          margin: 0;
          padding: 0;
        }
        
        *,
        *::before,
        *::after {
          box-sizing: inherit;
        }
        
        /* Typography */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
          margin: 0;
          font-weight: var(--font-weight-semibold);
          line-height: var(--line-height-tight);
          color: var(--color-text);
          letter-spacing: var(--letter-spacing-tight);
        }
        
        h1 {
          font-size: var(--font-size-4xl);
        }
        h2 {
          font-size: var(--font-size-3xl);
        }
        h3 {
          font-size: var(--font-size-2xl);
        }
        h4 {
          font-size: var(--font-size-xl);
        }
        h5 {
          font-size: var(--font-size-lg);
        }
        h6 {
          font-size: var(--font-size-md);
        }
        
        p {
          margin: 0 0 var(--space-16) 0;
        }
        
        a {
          color: var(--color-primary);
          text-decoration: none;
          transition: color var(--duration-fast) var(--ease-standard);
        }
        
        a:hover {
          color: var(--color-primary-hover);
        }
        
        code,
        pre {
          font-family: var(--font-family-mono);
          font-size: calc(var(--font-size-base) * 0.95);
          background-color: var(--color-secondary);
          border-radius: var(--radius-sm);
        }
        
        code {
          padding: var(--space-1) var(--space-4);
        }
        
        pre {
          padding: var(--space-16);
          margin: var(--space-16) 0;
          overflow: auto;
          border: 1px solid var(--color-border);
        }
        
        pre code {
          background: none;
          padding: 0;
        }
        
        /* Buttons */
        .btn {
          display: inline-flex;
          align-items: center;
          justify-content: center;
          padding: var(--space-8) var(--space-16);
          border-radius: var(--radius-base);
          font-size: var(--font-size-base);
          font-weight: 500;
          line-height: 1.5;
          cursor: pointer;
          transition: all var(--duration-normal) var(--ease-standard);
          border: none;
          text-decoration: none;
          position: relative;
        }
        
        .btn:focus-visible {
          outline: none;
          box-shadow: var(--focus-ring);
        }
        
        .btn--primary {
          background: var(--color-primary);
          color: var(--color-btn-primary-text);
        }
        
        .btn--primary:hover {
          background: var(--color-primary-hover);
        }
        
        .btn--primary:active {
          background: var(--color-primary-active);
        }
        
        .btn--secondary {
          background: var(--color-secondary);
          color: var(--color-text);
        }
        
        .btn--secondary:hover {
          background: var(--color-secondary-hover);
        }
        
        .btn--secondary:active {
          background: var(--color-secondary-active);
        }
        
        .btn--outline {
          background: transparent;
          border: 1px solid var(--color-border);
          color: var(--color-text);
        }
        
        .btn--outline:hover {
          background: var(--color-secondary);
        }
        
        .btn--sm {
          padding: var(--space-4) var(--space-12);
          font-size: var(--font-size-sm);
          border-radius: var(--radius-sm);
        }
        
        .btn--lg {
          padding: var(--space-10) var(--space-20);
          font-size: var(--font-size-lg);
          border-radius: var(--radius-md);
        }
        
        .btn--full-width {
          width: 100%;
        }
        
        .btn:disabled {
          opacity: 0.5;
          cursor: not-allowed;
        }
        
        /* Form elements */
        .form-control {
          display: block;
          width: 100%;
          padding: var(--space-8) var(--space-12);
          font-size: var(--font-size-md);
          line-height: 1.5;
          color: var(--color-text);
          background-color: var(--color-surface);
          border: 1px solid var(--color-border);
          border-radius: var(--radius-base);
          transition: border-color var(--duration-fast) var(--ease-standard),
            box-shadow var(--duration-fast) var(--ease-standard);
        }
        
        textarea.form-control {
          font-family: var(--font-family-base);
          font-size: var(--font-size-base);
        }
        
        select.form-control {
          padding: var(--space-8) var(--space-12);
          -webkit-appearance: none;
          -moz-appearance: none;
          appearance: none;
          background-image: var(--select-caret-light);
          background-repeat: no-repeat;
          background-position: right var(--space-12) center;
          background-size: 16px;
          padding-right: var(--space-32);
        }
        
        /* Add a dark mode specific caret */
        @media (prefers-color-scheme: dark) {
          select.form-control {
            background-image: var(--select-caret-dark);
          }
        }
        
        /* Also handle data-color-scheme */
        [data-color-scheme="dark"] select.form-control {
          background-image: var(--select-caret-dark);
        }
        
        [data-color-scheme="light"] select.form-control {
          background-image: var(--select-caret-light);
        }
        
        .form-control:focus {
          border-color: var(--color-primary);
          outline: var(--focus-outline);
        }
        
        .form-label {
          display: block;
          margin-bottom: var(--space-8);
          font-weight: var(--font-weight-medium);
          font-size: var(--font-size-sm);
        }
        
        .form-group {
          margin-bottom: var(--space-16);
        }
        
        /* Card component */
        .card {
          background-color: var(--color-surface);
          border-radius: var(--radius-lg);
          border: 1px solid var(--color-card-border);
          box-shadow: var(--shadow-sm);
          overflow: hidden;
          transition: box-shadow var(--duration-normal) var(--ease-standard);
        }
        
        .card:hover {
          box-shadow: var(--shadow-md);
        }
        
        .card__body {
          padding: var(--space-16);
        }
        
        .card__header,
        .card__footer {
          padding: var(--space-16);
          border-bottom: 1px solid var(--color-card-border-inner);
        }
        
        /* Status indicators - simplified with CSS variables */
        .status {
          display: inline-flex;
          align-items: center;
          padding: var(--space-6) var(--space-12);
          border-radius: var(--radius-full);
          font-weight: var(--font-weight-medium);
          font-size: var(--font-size-sm);
        }
        
        .status--success {
          background-color: rgba(
            var(--color-success-rgb, 33, 128, 141),
            var(--status-bg-opacity)
          );
          color: var(--color-success);
          border: 1px solid
            rgba(var(--color-success-rgb, 33, 128, 141), var(--status-border-opacity));
        }
        
        .status--error {
          background-color: rgba(
            var(--color-error-rgb, 192, 21, 47),
            var(--status-bg-opacity)
          );
          color: var(--color-error);
          border: 1px solid
            rgba(var(--color-error-rgb, 192, 21, 47), var(--status-border-opacity));
        }
        
        .status--warning {
          background-color: rgba(
            var(--color-warning-rgb, 168, 75, 47),
            var(--status-bg-opacity)
          );
          color: var(--color-warning);
          border: 1px solid
            rgba(var(--color-warning-rgb, 168, 75, 47), var(--status-border-opacity));
        }
        
        .status--info {
          background-color: rgba(
            var(--color-info-rgb, 98, 108, 113),
            var(--status-bg-opacity)
          );
          color: var(--color-info);
          border: 1px solid
            rgba(var(--color-info-rgb, 98, 108, 113), var(--status-border-opacity));
        }
        
        /* Container layout */
        .container {
          width: 100%;
          margin-right: auto;
          margin-left: auto;
          padding-right: var(--space-16);
          padding-left: var(--space-16);
        }
        
        @media (min-width: 640px) {
          .container {
            max-width: var(--container-sm);
          }
        }
        @media (min-width: 768px) {
          .container {
            max-width: var(--container-md);
          }
        }
        @media (min-width: 1024px) {
          .container {
            max-width: var(--container-lg);
          }
        }
        @media (min-width: 1280px) {
          .container {
            max-width: var(--container-xl);
          }
        }
        
        /* Utility classes */
        .flex {
          display: flex;
        }
        .flex-col {
          flex-direction: column;
        }
        .items-center {
          align-items: center;
        }
        .justify-center {
          justify-content: center;
        }
        .justify-between {
          justify-content: space-between;
        }
        .gap-4 {
          gap: var(--space-4);
        }
        .gap-8 {
          gap: var(--space-8);
        }
        .gap-16 {
          gap: var(--space-16);
        }
        
        .m-0 {
          margin: 0;
        }
        .mt-8 {
          margin-top: var(--space-8);
        }
        .mb-8 {
          margin-bottom: var(--space-8);
        }
        .mx-8 {
          margin-left: var(--space-8);
          margin-right: var(--space-8);
        }
        .my-8 {
          margin-top: var(--space-8);
          margin-bottom: var(--space-8);
        }
        
        .p-0 {
          padding: 0;
        }
        .py-8 {
          padding-top: var(--space-8);
          padding-bottom: var(--space-8);
        }
        .px-8 {
          padding-left: var(--space-8);
          padding-right: var(--space-8);
        }
        .py-16 {
          padding-top: var(--space-16);
          padding-bottom: var(--space-16);
        }
        .px-16 {
          padding-left: var(--space-16);
          padding-right: var(--space-16);
        }
        
        .block {
          display: block;
        }
        .hidden {
          display: none;
        }
        
        /* Accessibility */
        .sr-only {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          white-space: nowrap;
          border-width: 0;
        }
        
        :focus-visible {
          outline: var(--focus-outline);
          outline-offset: 2px;
        }
        
        /* Dark mode specifics */
        [data-color-scheme="dark"] .btn--outline {
          border: 1px solid var(--color-border-secondary);
        }
        
        @font-face {
          font-family: 'FKGroteskNeue';
          src: url('https://www.perplexity.ai/fonts/FKGroteskNeue.woff2')
            format('woff2');
        }
        
        /* Application-specific styles for Taiwan Truck Calculator */
        
        .subtitle {
            color: var(--color-text-secondary);
            margin-bottom: var(--space-32);
            font-size: var(--font-size-lg);
        }
        
        .input-section {
            background: var(--color-secondary);
            padding: var(--space-24);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-24);
        }
        
        .input-section h3 {
            margin-bottom: var(--space-20);
            color: var(--color-text);
        }
        
        .pallet-input {
            display: flex;
            gap: var(--space-8); /* Reduced gap for more items */
            margin-bottom: var(--space-16);
            align-items: center;
            flex-wrap: wrap;
        }
        
        .pallet-input label {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            margin-right: var(--space-4);
        }
        
        .pallet-input input[type="number"] { /* More specific selector */
            width: 70px; /* Adjusted width */
            margin: 0 var(--space-4);
        }
        
        .pallet-input span {
            color: var(--color-text);
            font-weight: var(--font-weight-medium);
            margin: 0 var(--space-4);
        }
        
        .button-group {
            margin-top: var(--space-20);
            display: flex;
            gap: var(--space-8);
            flex-wrap: wrap;
        }
        
        .btn-danger {
            background: var(--color-error);
            color: white;
            border: 1px solid var(--color-error);
        }
        
        .btn-danger:hover {
            background: rgba(var(--color-error-rgb), 0.8);
        }
        
        .results {
            margin-top: var(--space-32);
        }
        
        .results h2 {
            color: var(--color-text);
            margin-bottom: var(--space-24);
            font-size: var(--font-size-3xl);
        }
         .results h3 {
            color: var(--color-text);
            margin-top: var(--space-24);
            margin-bottom: var(--space-16);
            font-size: var(--font-size-2xl);
        }
        
        .vehicle-option {
            border: 2px solid var(--color-card-border);
            border-radius: var(--radius-lg);
            padding: var(--space-24);
            margin: var(--space-20) 0;
            transition: all var(--duration-normal) var(--ease-standard);
            background: var(--color-surface);
        }
        
        .vehicle-option.recommended {
            border-color: var(--color-success);
            background: rgba(var(--color-success-rgb), 0.05);
        }
                
        .vehicle-option.not-suitable {
            border-color: var(--color-error);
            background: rgba(var(--color-error-rgb), 0.05);
        }
        
        .vehicle-title {
            font-size: var(--font-size-2xl);
            font-weight: var(--font-weight-bold);
            margin-bottom: var(--space-12);
            color: var(--color-text);
        }
        
        .specs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); /* Adjusted minmax */
            gap: var(--space-12);
            margin: var(--space-20) 0;
        }
        
        .spec-item {
            background: var(--color-background);
            padding: var(--space-12);
            border-radius: var(--radius-base);
            border-left: 4px solid var(--color-primary);
            box-shadow: var(--shadow-sm);
        }
        
        .spec-item strong {
            color: var(--color-text);
            font-weight: var(--font-weight-semibold);
        }
        
        .overall-status-summary { /* For new cost optimization display */
            margin-top: var(--space-12);
            margin-bottom: var(--space-12);
            padding: var(--space-8);
            border-left: 4px solid var(--color-info);
            background-color: rgba(var(--color-info-rgb), 0.05);
            border-radius: var(--radius-sm);
        }
        .overall-status-summary span {
            display: block;
            margin-bottom: var(--space-4);
        }
        
        .layout-display {
            margin-top: var(--space-20);
            padding: var(--space-20);
            background: var(--color-background);
            border-radius: var(--radius-base);
            border: 1px solid var(--color-card-border);
        }
        
        .layout-display h4 {
            margin-bottom: var(--space-12);
            color: var(--color-text);
        }
        
        .layout-info {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-bottom: var(--space-12);
        }
                
        .error {
            color: var(--color-error);
            font-weight: var(--font-weight-semibold);
        }
        
        .success {
            color: var(--color-success);
            font-weight: var(--font-weight-semibold);
        }
        
        .warning { 
            color: var(--color-warning);
            font-weight: var(--font-weight-semibold);
        }
        
        .not-fitted-info { 
            margin-top: var(--space-16);
            padding: var(--space-12);
            background: rgba(var(--color-error-rgb), 0.1);
            border-radius: var(--radius-base);
            border-left: 4px solid var(--color-error);
        }
        
        .fitted-info { 
            margin-top: var(--space-16);
            padding: var(--space-12);
            background: rgba(var(--color-success-rgb), 0.1);
            border-radius: var(--radius-base);
            border-left: 4px solid var(--color-success);
        }
        
        .svg-container {
            margin: var(--space-16) 0;
            text-align: center;
        }
        
        .layout-legend {
            margin-top: var(--space-12);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .pallet-input {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-8);
            }
            
            .pallet-input label {
                min-width: auto;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .specs {
                grid-template-columns: 1fr;
            }
        }
        
        /* SVG styling adjustments */
        svg {
            max-width: 100%;
            height: auto;
            border: 2px solid var(--color-border);
            background: var(--color-surface);
            border-radius: var(--radius-base);
        }
        
        svg text {
            font-family: var(--font-family-base);
        }
        /* Styles for fixed space (pallet jack) */
        .fixed-space-options {
            background: var(--color-secondary);
            padding: var(--space-16);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-24);
            display: flex;
            align-items: center;
            gap: var(--space-16);
            flex-wrap: wrap;
        }
        .fixed-space-options label {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: var(--space-8);
        }
        .fixed-space-options input[type="checkbox"] {
            width: auto;
            margin: 0;
        }
        /* Styles for truck prices input */
        .truck-prices-input {
            background: var(--color-secondary);
            padding: var(--space-24);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-24);
        }
        .truck-prices-input h3 {
            margin-bottom: var(--space-20);
            color: var(--color-text);
        }
        .price-input-group {
            display: flex;
            align-items: center;
            gap: var(--space-8);
            margin-bottom: var(--space-12);
        }
        .price-input-group label {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text);
            min-width: 150px; /* Adjust as needed */
        }
        .price-input-group input[type="number"] {
            width: 120px; /* Adjust as needed */
        }

        #back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: none; /* Hidden by default */
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--color-primary);
            color: var(--color-btn-primary-text);
            border: none;
            font-size: 24px;
            cursor: pointer;
            z-index: 1000;
            box-shadow: var(--shadow-lg);
            transition: opacity 0.3s, visibility 0.3s;
        }
        #back-to-top:hover {
            background-color: var(--color-primary-hover);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöõ Âè∞ÁÅ£ËªäÂûãÈÅ∏ÊìáË®àÁÆóÂô®</h1>
        <p class="subtitle">Ê†πÊìöÊ£ßÊùøÂ∞∫ÂØ∏„ÄÅÈ´òÂ∫¶„ÄÅÈáçÈáèËàáÊï∏ÈáèÔºåÊé®Ëñ¶ÊúÄÁ∂ìÊøüÁöÑËªäÂûãÊñπÊ°à<br><small style="color: var(--color-text-secondary);">(Â∞èÊèêÁ§∫ÔºöËº∏ÂÖ•ÂÆåÊàêÂæåÂèØÁõ¥Êé•Êåâ‰∏ã Enter ÈçµÈÄ≤Ë°åË®àÁÆó)</small></p>
        
        <div class="input-section">
            <h3>Ê£ßÊùøË≥áË®äËº∏ÂÖ•</h3>
            <div id="pallet-inputs">
                <div class="pallet-input">
                    <label for="pallet-default-length">Ê£ßÊùøÈ°ûÂûã:</label>
                    <input type="number" placeholder="Èï∑Â∫¶(cm)" class="pallet-length form-control" id="pallet-default-length" value="120">
                    <span>√ó</span>
                    <input type="number" placeholder="ÂØ¨Â∫¶(cm)" class="pallet-width form-control" id="pallet-default-width" value="100">
                    <span>cmÔºå</span>
                    <label for="pallet-default-height">È´ò(cm):</label>
                    <input type="number" placeholder="È´òÂ∫¶(cm)" class="pallet-height form-control" id="pallet-default-height" value="100">
                    <label for="pallet-default-weight">ÂñÆÈáç(kg):</label>
                    <input type="number" placeholder="ÈáçÈáè(kg)" class="pallet-weight form-control" id="pallet-default-weight" value="25">
                    <span>ÔºåÊï∏Èáè:</span>
                    <input type="number" placeholder="Êï∏Èáè" class="pallet-count form-control" id="pallet-default-count" value="1" min="1">
                    <button class="btn btn--outline btn-danger" onclick="removePallet(this)">Âà™Èô§</button>
                </div>
            </div>
            
            <div class="button-group">
                <button class="btn btn--secondary" onclick="addPallet()">+ Êñ∞Â¢ûÊ£ßÊùøÈ°ûÂûã</button>
                <button class="btn btn--secondary" onclick="addCommonPallet('110x110')">Âø´ÈÄüÊñ∞Â¢û 110√ó110cm</button>
                <button class="btn btn--secondary" onclick="addCommonPallet('120x100')">Âø´ÈÄüÊñ∞Â¢û 120√ó100cm</button>
                <button class="btn btn--secondary" onclick="addCommonPallet('120x80')">Âø´ÈÄüÊñ∞Â¢û 120√ó80cm</button>
            </div>
        </div>

        <!-- Êñ∞Â¢ûÁöÑË≤®ËªäÂñÆÂÉπË®≠ÂÆöÂçÄÂ°ä -->
        <div class="truck-prices-input">
            <h3>ËªäË°åËàáÂñÆÂÉπË®≠ÂÆö</h3>
            <p>Ë´ãÁ¢∫Ë™çÂêÑËªäÂûãÂñÆÂÉπËàáÊùêÁ©çÔºåË®àÁÆóÊôÇÂ∞áÊúÉË©ï‰º∞ÊâÄÊúâËªäÂûã„ÄÇ</p>
            <div id="price-inputs-wrapper">
                <!-- Price inputs populated by JS -->
            </div>
        </div>
        
        <button class="btn btn--primary" onclick="calculate()">‚öñÔ∏è Ë®àÁÆóÊúÄ‰Ω≥ÊñπÊ°à</button>
        
        <div class="results" id="results"></div>
    </div>

    <button id="back-to-top" title="ÂõûÂà∞ÊúÄ‰∏äÊñπ">‚Üë</button>

    <script>
        // ËªäÂûãË¶èÊ†ºÂÆöÁæ© (Êï¥ÂêàÊâÄÊúâËªäË°å)
        const vehicleSpecs = {
            'Â§ßË™†-3.49T': { name: '3.49T (Â§ßË™†)', length: 340, width: 170, height: 160, maxWeight: 1500, price: 3000 },
            'ÂÖÉÁöì-8.8T': { name: '8.8T (ÂÖÉÁöì)', length: 580, width: 200, height: 200, maxWeight: 5000, price: 6500 },
            'ÂÖÉÁöì-17T': { name: '17T (ÂÖÉÁöì)', length: 810, width: 238, height: 240, maxWeight: 7500, price: 8500 },
            'ÁøîÂ§™-17T': { name: '17T (ÁøîÂ§™)', length: 800, width: 240, height: 238, maxWeight: 7500, price: 8500 }
        };
        
        function populateVehiclePriceInputs() {
            const wrapper = document.getElementById('price-inputs-wrapper');
            wrapper.innerHTML = ''; // Clear existing inputs

            for (const [vehicleKey, spec] of Object.entries(vehicleSpecs)) {
                const volumeM3 = (spec.length * spec.width * spec.height / 1000000).toFixed(1);
                const inputGroup = document.createElement('div');
                inputGroup.className = 'price-input-group';
                
                const uniqueId = `price-${vehicleKey}`.replace(/\s/g, '-');

                inputGroup.innerHTML = `
                    <label for="${uniqueId}">${spec.name} (${spec.length}x${spec.width}x${spec.height}cm, ${volumeM3} m¬≥):</label>
                    <input type="number" id="${uniqueId}" class="form-control truck-price-input" value="${spec.price}" min="0" data-vehicle-type="${vehicleKey}">
                `;
                wrapper.appendChild(inputGroup);
            }
        }

        function addPallet() {
            const container = document.getElementById('pallet-inputs');
            const newPallet = document.createElement('div');
            newPallet.className = 'pallet-input';
            const uniqueIdPrefix = `pallet-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            newPallet.innerHTML = `
                <label for="${uniqueIdPrefix}-length">Ê£ßÊùøÈ°ûÂûã:</label>
                <input type="number" placeholder="Èï∑Â∫¶(cm)" class="pallet-length form-control" id="${uniqueIdPrefix}-length" value="120">
                <span>√ó</span>
                <input type="number" placeholder="ÂØ¨Â∫¶(cm)" class="pallet-width form-control" id="${uniqueIdPrefix}-width" value="100">
                <span>cmÔºå</span>
                <label for="${uniqueIdPrefix}-height">È´ò(cm):</label>
                <input type="number" placeholder="È´òÂ∫¶(cm)" class="pallet-height form-control" id="${uniqueIdPrefix}-height" value="100">
                <label for="${uniqueIdPrefix}-weight">ÂñÆÈáç(kg):</label>
                <input type="number" placeholder="ÈáçÈáè(kg)" class="pallet-weight form-control" id="${uniqueIdPrefix}-weight" value="25">
                <span>ÔºåÊï∏Èáè:</span>
                <input type="number" placeholder="Êï∏Èáè" class="pallet-count form-control" id="${uniqueIdPrefix}-count" value="1" min="1">
                <button class="btn btn--outline btn-danger" onclick="removePallet(this)">Âà™Èô§</button>
            `;
            container.appendChild(newPallet);
        }
        
        function addCommonPallet(size) {
            const [length, width] = size.split('x').map(Number);
            const container = document.getElementById('pallet-inputs');
            const newPallet = document.createElement('div');
            newPallet.className = 'pallet-input';
            const uniqueIdPrefix = `pallet-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
            newPallet.innerHTML = `
                <label for="${uniqueIdPrefix}-length">Ê£ßÊùøÈ°ûÂûã:</label>
                <input type="number" placeholder="Èï∑Â∫¶(cm)" class="pallet-length form-control" id="${uniqueIdPrefix}-length" value="${length}">
                <span>√ó</span>
                <input type="number" placeholder="ÂØ¨Â∫¶(cm)" class="pallet-width form-control" id="${uniqueIdPrefix}-width" value="${width}">
                <span>cmÔºå</span>
                <label for="${uniqueIdPrefix}-height">È´ò(cm):</label>
                <input type="number" placeholder="È´òÂ∫¶(cm)" class="pallet-height form-control" id="${uniqueIdPrefix}-height" value="100">
                <label for="${uniqueIdPrefix}-weight">ÂñÆÈáç(kg):</label>
                <input type="number" placeholder="ÈáçÈáè(kg)" class="pallet-weight form-control" id="${uniqueIdPrefix}-weight" value="25">
                <span>ÔºåÊï∏Èáè:</span>
                <input type="number" placeholder="Êï∏Èáè" class="pallet-count form-control" id="${uniqueIdPrefix}-count" value="1" min="1">
                <button class="btn btn--outline btn-danger" onclick="removePallet(this)">Âà™Èô§</button>
            `;
            container.appendChild(newPallet);
        }
        
        function removePallet(button) {
            const container = document.getElementById('pallet-inputs');
            if (container.children.length > 1) {
                button.parentElement.remove();
            } else {
                alert('Ëá≥Â∞ëÈúÄË¶Å‰øùÁïô‰∏ÄÂÄãÊ£ßÊùøÈ°ûÂûãÔºÅ');
            }
        }

        function getVehiclePricesFromUI() {
            const prices = {};
            const priceInputs = document.querySelectorAll('.truck-price-input');
            let pricesValid = true;

            priceInputs.forEach(input => {
                const vehicleType = input.dataset.vehicleType;
                const price = parseInt(input.value);

                if (isNaN(price) || price < 0) {
                    input.style.borderColor = "red";
                    pricesValid = false;
                } else {
                    input.style.borderColor = "";
                    prices[vehicleType] = price;
                }
            });
            
            if (!pricesValid) {
                alert("Ë≤®ËªäÂñÆÂÉπÂøÖÈ†àÊòØÊúâÊïàÁöÑÈùûË≤†Êï∏Â≠óÔºÅÈåØË™§Ê¨Ñ‰ΩçÂ∑≤Ê®ôÁ¥Ö„ÄÇ");
                return null;
            }
            return prices;
        }
        
        function collectPalletData() {
            const palletInputs = document.querySelectorAll('.pallet-input');
            const pallets = [];
            let hasInvalidInput = false;
            let palletInstanceCounter = 0; 
        
            palletInputs.forEach(inputDiv => { 
                const lengthInput = inputDiv.querySelector('.pallet-length');
                const widthInput = inputDiv.querySelector('.pallet-width');
                const heightInput = inputDiv.querySelector('.pallet-height');
                const countInput = inputDiv.querySelector('.pallet-count');
                const weightInput = inputDiv.querySelector('.pallet-weight');

                const length = parseInt(lengthInput.value);
                const width = parseInt(widthInput.value);
                const height = parseInt(heightInput.value);
                const count = parseInt(countInput.value);
                const weight = parseInt(weightInput.value);
        
                let currentInputValid = true;
                // Validate each input field
                if (isNaN(length) || length <= 0) { currentInputValid = false; lengthInput.style.borderColor = "red"; } else { lengthInput.style.borderColor = "";}
                if (isNaN(width) || width <= 0) { currentInputValid = false; widthInput.style.borderColor = "red"; } else { widthInput.style.borderColor = "";}
                if (isNaN(height) || height <= 0) { currentInputValid = false; heightInput.style.borderColor = "red"; } else { heightInput.style.borderColor = "";}
                if (isNaN(count) || count <= 0) { currentInputValid = false; countInput.style.borderColor = "red"; } else { countInput.style.borderColor = "";}
                if (isNaN(weight) || weight < 0) { currentInputValid = false; weightInput.style.borderColor = "red"; } else { weightInput.style.borderColor = "";}
                
                if (!currentInputValid) {
                    hasInvalidInput = true;
                    return; 
                }
        
                // Create individual pallet instances for packing algorithm
                for (let i = 0; i < count; i++) {
                    pallets.push({ 
                        length, 
                        width, 
                        height, 
                        weight, 
                        id: `palletInstance-${palletInstanceCounter++}` 
                    });
                }
            });
        
            if (hasInvalidInput) {
                alert('Ë´ãÁ¢∫‰øùÊâÄÊúâÊ£ßÊùøÁöÑÈï∑„ÄÅÂØ¨„ÄÅÈ´ò„ÄÅÊï∏ÈáèÂíåÂñÆÂÄãÈáçÈáèÈÉΩÂ°´ÂØ´ÁÇ∫ÊúâÊïàÁöÑÊ≠£Êï∏ÔºàÈáçÈáèÂèØÁÇ∫0ÔºâÔºÅÈåØË™§Ê¨Ñ‰ΩçÂ∑≤Ê®ôÁ¥Ö„ÄÇ');
                return null; 
            }
            return pallets;
        }

        function calculate() {
            const allOriginalPallets = collectPalletData();
            if (!allOriginalPallets) {
                return;
            }
            if (allOriginalPallets.length === 0) {
                document.getElementById('results').innerHTML = '<p class="warning">Ë´ãËá≥Â∞ëËº∏ÂÖ•‰∏ÄÁ®ÆÊ£ßÊùøÈ°ûÂûãÔºÅ</p>';
                return;
            }

            const currentVehiclePrices = getVehiclePricesFromUI();
            if (!currentVehiclePrices) { // If prices are invalid, stop calculation
                return;
            }

            // No longer need includePalletJack or selectedCompany

            const costOptimizedSolutions = [];

            // Iterate over all available vehicles
            for (const [vehicleType, currentVehicleSpec] of Object.entries(vehicleSpecs)) {
                let palletsRemainingToLoad = JSON.parse(JSON.stringify(allOriginalPallets)); 
                let trucksNeededForThisType = 0;
                let canLoadAllPalletsWithThisType = true;
                const truckLoadDetailsForThisVehicleType = []; 

                while (palletsRemainingToLoad.length > 0) {
                    trucksNeededForThisType++;
                    const singleTruckLoadResult = evaluateSingleTruckCapacity(palletsRemainingToLoad, currentVehicleSpec);

                    if (singleTruckLoadResult.reasonForFailure) { // If pallet jack too big for this truck
                        canLoadAllPalletsWithThisType = false;
                        break;
                    }
                    if (singleTruckLoadResult.fittedPalletsCount === 0 && palletsRemainingToLoad.length > 0) {
                        canLoadAllPalletsWithThisType = false;
                        break;
                    }
                    
                    truckLoadDetailsForThisVehicleType.push({
                        truckNumber: trucksNeededForThisType,
                        loadedPallets: singleTruckLoadResult.placed, 
                        notLoadedInThisTruck: singleTruckLoadResult.notFitted, 
                        weightOKForThisTruck: singleTruckLoadResult.weightOK,
                        totalWeightInThisTruck: singleTruckLoadResult.totalWeightOfFittedPallets
                    });

                    const fittedPalletIdsThisRound = new Set(singleTruckLoadResult.placed.map(p => p.id));
                    palletsRemainingToLoad = palletsRemainingToLoad.filter(p => !fittedPalletIdsThisRound.has(p.id));
                }

                if (canLoadAllPalletsWithThisType && palletsRemainingToLoad.length === 0) {
                    const totalCostForThisType = trucksNeededForThisType * currentVehiclePrices[vehicleType]; // Use dynamic price
                    costOptimizedSolutions.push({
                        vehicleType,
                        vehicleName: currentVehicleSpec.name,
                        specs: currentVehicleSpec, 
                        numTrucks: trucksNeededForThisType,
                        totalCost: totalCostForThisType,
                        pricePerTruck: currentVehiclePrices[vehicleType], // Use dynamic price
                        truckLoadDetails: truckLoadDetailsForThisVehicleType,
                        efficiency: '100.0', 
                        fittedPallets: allOriginalPallets.length,
                        totalPallets: allOriginalPallets.length
                    });
                } else {
                     costOptimizedSolutions.push({
                        vehicleType,
                        vehicleName: currentVehicleSpec.name,
                        specs: currentVehicleSpec, 
                        numTrucks: trucksNeededForThisType, 
                        totalCost: Infinity, 
                        pricePerTruck: currentVehiclePrices[vehicleType], // Use dynamic price
                        reasonForFailure: singleTruckLoadResult.reasonForFailure || "ÁÑ°Ê≥ï‰ΩøÁî®Ê≠§È°ûÂûãË≤®ËªäË£ùËºâÊâÄÊúâÊ£ßÊùøÔºàÂèØËÉΩÂõ†Â∞∫ÂØ∏„ÄÅÈ´òÂ∫¶„ÄÅÈáçÈáèÈôêÂà∂ÊàñÁ©∫Èñì‰∏çË∂≥Ôºâ„ÄÇ",
                        efficiency: '0.0',
                        fittedPallets: 0, 
                        totalPallets: allOriginalPallets.length
                    });
                }
            }
            displayCostOptimizedResults(costOptimizedSolutions, allOriginalPallets.length);
        }

        /**
         * Evaluates how many pallets from palletsToLoad can fit into a SINGLE vehicle.
         * Accounts for height, 2D packing, and weight limits for that single vehicle.
         */
        function evaluateSingleTruckCapacity(palletsToLoad, vehicleSpec) {
            const { length: vLength, width: vWidth, height: vHeight, maxWeight } = vehicleSpec;
            const palletsConsideredForLoading = JSON.parse(JSON.stringify(palletsToLoad)); 

            // 1. Height Check: Filter out pallets too tall for this single truck
            const palletsSuitableForHeight = palletsConsideredForLoading.filter(p => p.height <= vHeight);
            const palletsInitiallyTooTall = palletsConsideredForLoading.filter(p => p.height > vHeight);

            if (palletsSuitableForHeight.length === 0 && palletsConsideredForLoading.length > 0) {
                return {
                    placed: [],
                    notFitted: palletsConsideredForLoading, 
                    fittedPalletsCount: 0,
                    weightOK: false,
                    totalWeightOfFittedPallets: 0,
                };
            }

            // 2. 2D Space Packing (using the existing packPallets function)
            const layouts = [];
            layouts.push(packPallets(palletsSuitableForHeight, vLength, vWidth, false)); 
            layouts.push(packPallets(palletsSuitableForHeight, vLength, vWidth, true));  
            
            let bestLayout = layouts.reduce((best, current) =>
                current.fittedCount > best.fittedCount ? current : best, 
                { placed: [], notFitted: [...palletsSuitableForHeight], fittedCount: 0 }
            );
            
            let currentPlacedPallets = [...bestLayout.placed];
            let totalWeightOfFittedPallets = currentPlacedPallets.reduce((sum, p) => sum + p.weight, 0);
            let weightOK = totalWeightOfFittedPallets <= maxWeight;
            let notFittedDueToWeight = []; 

            if (!weightOK && currentPlacedPallets.length > 0) {
                const sortedForRemoval = [...currentPlacedPallets].sort((a,b) => (a.length * a.width) - (b.length * a.width));
                
                while(totalWeightOfFittedPallets > maxWeight && sortedForRemoval.length > 0) {
                    const removedPallet = sortedForRemoval.shift(); 
                    totalWeightOfFittedPallets -= removedPallet.weight;
                    notFittedDueToWeight.push(removedPallet);
                }
                currentPlacedPallets = sortedForRemoval; 
                weightOK = totalWeightOfFittedPallets <= maxWeight; 
            }
            
            return {
                placed: currentPlacedPallets, 
                notFitted: bestLayout.notFitted.concat(palletsInitiallyTooTall).concat(notFittedDueToWeight),
                fittedPalletsCount: currentPlacedPallets.length,
                weightOK, 
                totalWeightOfFittedPallets, 
            };
        }
        
        /**
         * Packs pallets into a 2D container using a simple greedy algorithm.
         * @param {Array} pallets - Pallets to pack (assumed height & weight already checked if needed).
         * @param {number} containerLength - Container length.
         * @param {number} containerWidth - Container width.
         * @param {boolean} allowRotation - Whether pallets can be rotated 90 degrees.
         * @returns {Object} Object with placed and notFitted pallets.
         */
        function packPallets(pallets, containerLength, containerWidth, allowRotation) {
            // Sort pallets by area in descending order (common heuristic for greedy packing)
            const sortedPallets = [...pallets].sort((a, b) => (b.length * b.width) - (a.length * a.width));
            const placed = [];
            const notFittedInitially = []; 
            
            const occupiedSpaces = []; 
        
            const step = 1; // 1cm step for higher precision
        
            for (const pallet of sortedPallets) {
                let fitted = false;
                const orientations = [{ length: pallet.length, width: pallet.width, rotated: false }];
                if (allowRotation && pallet.length !== pallet.width) { // Only rotate if dimensions are different
                    orientations.push({ length: pallet.width, width: pallet.length, rotated: true });
                }
        
                for (const orientation of orientations) {
                    if (fitted) break;
                    // Iterate through possible positions (x, y)
                    for (let y = 0; y <= containerWidth - orientation.width; y += step) { 
                        if (fitted) break;
                        for (let x = 0; x <= containerLength - orientation.length; x += step) {
                            const rect = { x, y, x2: x + orientation.length, y2: y + orientation.width };
                            if (!isOverlapping(rect, occupiedSpaces)) {
                                occupiedSpaces.push(rect);
                                placed.push({
                                    ...pallet, 
                                    x, y,
                                    placedLength: orientation.length,
                                    placedWidth: orientation.width,   
                                    rotated: orientation.rotated
                                });
                                fitted = true;
                                break;
                            }
                        }
                    }
                }
                if (!fitted) {
                    notFittedInitially.push(pallet);
                }
            }
            return { placed, notFitted: notFittedInitially, fittedCount: placed.length };
        }
        
        /**
         * Checks if a new rectangle overlaps with any existing occupied spaces.
         * @param {Object} rect - The new rectangle {x, y, x2, y2}.
         * @param {Array} occupiedSpaces - Array of existing occupied rectangles.
         * @returns {boolean} True if overlaps, false otherwise.
         */
        function isOverlapping(rect, occupiedSpaces) {
            for (const occupied of occupiedSpaces) {
                // Check for non-overlap conditions
                if (!(rect.x2 <= occupied.x || rect.x >= occupied.x2 || 
                      rect.y2 <= occupied.y || rect.y >= occupied.y2)) {
                    return true; // Overlap detected
                }
            }
            return false; // No overlap
        }
        
        /**
         * Displays the cost-optimized truck loading solutions.
         * @param {Array} solutions - Array of solution objects sorted by cost.
         * @param {number} totalOriginalPalletsCount - Total number of pallets initially input.
         */
        function displayCostOptimizedResults(solutions, totalOriginalPalletsCount) {
            const resultsDiv = document.getElementById('results');
            solutions.sort((a, b) => a.totalCost - b.totalCost);

            let html = '<h2>üí∞ ÊúÄÁ∂ìÊøüÂè´ËªäÊñπÊ°àÂª∫Ë≠∞</h2>';

            if (solutions.length === 0 || solutions[0].totalCost === Infinity) {
                html += '<p class="error">Êä±Ê≠âÔºåÊ†πÊìöÁõÆÂâçÁöÑÊ£ßÊùøË≥áË®äÂíåËªäÂûãÔºåÊâæ‰∏çÂà∞ÂêàÈÅ©ÁöÑÂè´ËªäÊñπÊ°à‰æÜÈÅãÈÄÅÊâÄÊúâÊ£ßÊùø„ÄÇ</p>';
                resultsDiv.innerHTML = html;
                return;
            }

            const bestSolution = solutions[0];
            html += `
                <div class="vehicle-option recommended">
                    <div class="vehicle-title">
                        üèÜ ÊúÄÂàíÁÆóÊñπÊ°à: ${bestSolution.numTrucks} Âè∞ ${bestSolution.vehicleName}
                    </div>
                    <div class="specs">
                        <div class="spec-item">
                            <strong>ËªäÂªÇÂ∞∫ÂØ∏:</strong><br>
                            ${bestSolution.specs.length} √ó ${bestSolution.specs.width} √ó ${bestSolution.specs.height} cm
                        </div>
                        <div class="spec-item">
                            <strong>ËºâÈáçËÉΩÂäõ:</strong><br>
                            ${bestSolution.specs.maxWeight} kg
                        </div>
                        <div class="spec-item">
                            <strong>Ë£ùËºâÊïàÁéá:</strong><br>
                            <span class="${bestSolution.efficiency === '100.0' ? 'success' : 'error'}">
                                ${bestSolution.efficiency}%
                            </span>
                        </div>
                        <div class="spec-item">
                            <strong>Ê£ßÊùøÈÖçÁΩÆ:</strong><br>
                            ${bestSolution.fittedPallets}/${bestSolution.totalPallets} ÂÄã
                        </div>
                        <div class="spec-item">
                            <strong>Á∏ΩÊàêÊú¨:</strong><br>
                            <span class="success">$${bestSolution.totalCost.toLocaleString()}</span>
                        </div>
                        <div class="spec-item">
                            <strong>ÊØèÂè∞ËªäÂÉπÊ†º:</strong><br>
                            $${bestSolution.pricePerTruck.toLocaleString()}
                        </div>
                        <div class="spec-item">
                            <strong>Á∏ΩÊ£ßÊùøÊï∏:</strong><br>
                            ${totalOriginalPalletsCount} ÂÄã
                        </div>
                         <div class="spec-item">
                            <strong>ÊâÄÈúÄËªäËºõÊï∏:</strong><br>
                            ${bestSolution.numTrucks} Âè∞
                        </div>
                    </div>
                    <p>Ê≠§ÊñπÊ°à‰ΩøÁî® ${bestSolution.numTrucks} Âè∞ ${bestSolution.vehicleType} ÂûãË≤®Ëªä„ÄÇÊâÄÊúâÊ£ßÊùøÂùáÂèØË£ùËºâ„ÄÇ</p>
                    
                    <!-- Display layout for each truck in the best solution -->
                    ${bestSolution.truckLoadDetails.map((truckDetail, index) => `
                        <div class="layout-display">
                            <h4>üì¶ Á¨¨ ${index + 1} Âè∞ ${bestSolution.vehicleType} ÈÖçÁΩÆÂúñ:</h4>
                            <div class="layout-info">
                                ËªäÂªÇ: ${bestSolution.specs.length}√ó${bestSolution.specs.width}cm
                            </div>
                            <div class="svg-container">
                                ${generateLayoutVisualization(
                                    { 
                                        placed: truckDetail.loadedPallets, 
                                        notFitted: truckDetail.notLoadedInThisTruck, 
                                        fittedCount: truckDetail.loadedPallets.length
                                    }, 
                                    bestSolution.specs // Pass the vehicle spec for correct dimensions
                                )}
                            </div>
                            <div class="fitted-info">
                                <span class="success">‚úÖ Ê≠§ËªäË£ùËºâ: ${truckDetail.loadedPallets.length} ÂÄãÊ£ßÊùø</span><br>
                                <span>Á∏ΩÈáçÈáè: ${truckDetail.totalWeightInThisTruck.toLocaleString()} kg 
                                    ${truckDetail.weightOKForThisTruck ? '(Á¨¶ÂêàËºâÈáç)' : '<span class="error">(Ë∂ÖÈáç!)</span>'}
                                </span>
                            </div>
                            ${truckDetail.notLoadedInThisTruck && truckDetail.notLoadedInThisTruck.length > 0 ? `
                                <div class="not-fitted-info" style="font-size:0.8em; margin-top:5px;">
                                    <span class="warning">‚ö†Ô∏è Ê≠§ËªäÊú™Ë£ùËºâ (ÂæûÊú¨Ëº™ÂàÜÈÖç): ${truckDetail.notLoadedInThisTruck.length} ÂÄã</span>
                                    <br>Êú™ËÉΩË£ùËºâÁöÑÊ£ßÊùøÔºö${truckDetail.notLoadedInThisTruck.map(p => `${p.length}x${p.width}x${p.height}cm`).join(', ')}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;

            if (solutions.length > 1) {
                html += '<h3>ÂÖ∂‰ªñËªäÂûãÊñπÊ°àÊàêÊú¨ÂàÜÊûê (Ëã•ÂèØË°å):</h3>';
                solutions.slice(1).forEach(sol => {
                    if (sol.totalCost === Infinity) {
                         html += `
                            <div class="vehicle-option not-suitable">
                                <div class="vehicle-title">${sol.numTrucks > 0 ? sol.numTrucks + ' Âè∞ ' : ''}${sol.vehicleName}</div>
                                <p class="error">${sol.reasonForFailure || 'ÁÑ°Ê≥ï‰ΩøÁî®Ê≠§È°ûÂûãË≤®ËªäË£ùËºâÊâÄÊúâÊ£ßÊùø„ÄÇ'}</p>
                            </div>
                        `;
                    } else {
                        html += `
                            <div class="vehicle-option">
                                <div class="vehicle-title">${sol.numTrucks} Âè∞ ${sol.vehicleName}</div>
                                 <div class="specs">
                                    <div class="spec-item">
                                        <strong>ËªäÂªÇÂ∞∫ÂØ∏:</strong><br>
                                        ${sol.specs.length} √ó ${sol.specs.width} √ó ${sol.specs.height} cm
                                    </div>
                                    <div class="spec-item">
                                        <strong>ËºâÈáçËÉΩÂäõ:</strong><br>
                                        ${sol.specs.maxWeight} kg
                                    </div>
                                    <div class="spec-item">
                                        <strong>Ë£ùËºâÊïàÁéá:</strong><br>
                                        <span class="${sol.efficiency === '100.0' ? 'success' : 'error'}">
                                            ${sol.efficiency}%
                                        </span>
                                    </div>
                                    <div class="spec-item">
                                        <strong>Ê£ßÊùøÈÖçÁΩÆ:</strong><br>
                                        ${sol.fittedPallets}/${sol.totalPallets} ÂÄã
                                    </div>
                                    <div class="spec-item">
                                        <strong>Á∏ΩÊàêÊú¨:</strong><br>
                                        $${sol.totalCost.toLocaleString()}
                                    </div>
                                    <div class="spec-item">
                                        <strong>ÊâÄÈúÄËªäËºõÊï∏:</strong><br>
                                        ${sol.numTrucks} Âè∞
                                    </div>
                                     <div class="spec-item">
                                        <strong>ÊØèÂè∞ËªäÂÉπÊ†º:</strong><br>
                                        $${sol.pricePerTruck.toLocaleString()}
                                    </div>
                                </div>
                                <!-- Display layout for each truck in this alternative solution -->
                                ${sol.truckLoadDetails.map((truckDetail, index) => `
                                    <div class="layout-display">
                                        <h4>üì¶ Á¨¨ ${index + 1} Âè∞ ${sol.vehicleType} ÈÖçÁΩÆÂúñ:</h4>
                                        <div class="layout-info">
                                            ËªäÂªÇ: ${sol.specs.length}√ó${sol.specs.width}cm
                                        </div>
                                        <div class="svg-container">
                                            ${generateLayoutVisualization(
                                                { 
                                                    placed: truckDetail.loadedPallets, 
                                                    notFitted: truckDetail.notLoadedInThisTruck, 
                                                    fittedCount: truckDetail.loadedPallets.length
                                                }, 
                                                sol.specs
                                            )}
                                        </div>
                                        <div class="fitted-info">
                                            <span class="success">‚úÖ Ê≠§ËªäË£ùËºâ: ${truckDetail.loadedPallets.length} ÂÄãÊ£ßÊùø</span><br>
                                            <span>Á∏ΩÈáçÈáè: ${truckDetail.totalWeightInThisTruck.toLocaleString()} kg 
                                                ${truckDetail.weightOKForThisTruck ? '(Á¨¶ÂêàËºâÈáç)' : '<span class="error">(Ë∂ÖÈáç!)</span>'}
                                            </span>
                                        </div>
                                        ${truckDetail.notLoadedInThisTruck && truckDetail.notLoadedInThisTruck.length > 0 ? `
                                            <div class="not-fitted-info" style="font-size:0.8em; margin-top:5px;">
                                                <span class="warning">‚ö†Ô∏è Ê≠§ËªäÊú™Ë£ùËºâ (ÂæûÊú¨Ëº™ÂàÜÈÖç): ${truckDetail.notLoadedInThisTruck.length} ÂÄã</span>
                                                <br>Êú™ËÉΩË£ùËºâÁöÑÊ£ßÊùøÔºö${truckDetail.notLoadedInThisTruck.map(p => `${p.length}x${p.width}x${p.height}cm`).join(', ')}
                                            </div>
                                        ` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    }
                });
            }
            resultsDiv.innerHTML = html;
        }
        
        // generateLayoutVisualization ÂáΩÊï∏ÁèæÂú®Êé•Êî∂ÂñÆÂè∞ËªäÁöÑË¶èÊ†º
        function generateLayoutVisualization(layout, vehicleSpec) { 
            const maxSvgDisplayWidth = 400; 
            const maxSvgDisplayHeight = 300; 
            
            const scaleX = maxSvgDisplayWidth / vehicleSpec.length;
            const scaleY = maxSvgDisplayHeight / vehicleSpec.width;
            const scale = Math.min(scaleX, scaleY, 1); 
        
            const containerWidth = vehicleSpec.length * scale;
            const containerHeight = vehicleSpec.width * scale;
            
            let svg = `
                <svg width="${containerWidth + 50}" height="${containerHeight + 50}" viewBox="0 0 ${containerWidth + 50} ${containerHeight + 50}" style="display:block; margin:auto;">
                    <rect x="25" y="25" width="${containerWidth}" height="${containerHeight}" 
                          fill="var(--color-surface)" stroke="var(--color-border)" stroke-width="2"/>
            `;

            if (layout && layout.placed && Array.isArray(layout.placed)) {
                layout.placed.forEach((pallet) => { 
                    const x = 25 + pallet.x * scale;
                    const y = 25 + pallet.y * scale;
                    const width = pallet.placedLength * scale;
                    const height = pallet.placedWidth * scale;
                    const color = "#FFCC00"; // background color
                    const textColor = "#D40511"; // text color
                    
                    svg += `
                        <rect x="${x}" y="${y}" width="${width}" height="${height}" 
                              fill="${color}" stroke="#D4A900" stroke-width="1" opacity="0.8"/>
                        <text x="${x + width/2}" y="${y + height/2}" 
                              text-anchor="middle" dominant-baseline="middle" 
                              font-size="${Math.min(width, height) > 20 ? 10 : 8}" font-weight="bold" fill="${textColor}">
                            ${pallet.length}√ó${pallet.width}
                            ${pallet.rotated ? '‚Üª' : ''}
                        </text>
                    `;
                });
            }
            svg += '</svg>';
            
            let legend = '<div class="layout-legend">';
            if (layout && layout.placed && Array.isArray(layout.placed)) {
                legend += `<span class="success">‚úÖ Â∑≤ÊîæÁΩÆ: ${layout.placed.length} ÂÄãÊ£ßÊùø</span>`;
                if (layout.placed.some(p => p.rotated)) {
                    legend += '<span style="margin-left: 15px;">‚Üª = Â∑≤ÊóãËΩâ90¬∞</span>';
                }
            } else {
                legend += '<span>ÁÑ°Ê£ßÊùøÈÖçÁΩÆÂúñÂèØÈ°ØÁ§∫ (Ê≠§ËªäÁÑ°Ê£ßÊùøË£ùËºâ)„ÄÇ</span>';
            }
            legend += '</div>';
            return legend + svg; 
        }
        
        // Helper for consistent coloring based on ID (simple hash)
        String.prototype.hashCode = function() {
            var hash = 0, i, chr;
            if (this.length === 0) return hash;
            for (i = 0; i < this.length; i++) {
                chr   = this.charCodeAt(i);
                hash  = ((hash << 5) - hash) + chr;
                hash |= 0; // Convert to 32bit integer
            }
            return Math.abs(hash);
        };

        document.addEventListener('DOMContentLoaded', function() {
            console.log('Âè∞ÁÅ£ËªäÂûãÈÅ∏ÊìáË®àÁÆóÂô®Â∑≤ËºâÂÖ• (Âê´ÊàêÊú¨ÂÑ™ÂåñËàáÂ§öËªäÈÖçÁΩÆÂúñ)');
            
            populateVehiclePriceInputs();

            // Add event listener for Enter key to trigger calculation
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault(); // Prevent default action (like form submission)
                    calculate();
                }
            });

            // Back to top button logic
            const backToTopButton = document.getElementById('back-to-top');
            window.onscroll = () => {
                if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
                    backToTopButton.style.display = "block";
                } else {
                    backToTopButton.style.display = "none";
                }
            };
            backToTopButton.addEventListener('click', () => {
                window.scrollTo({top: 0, behavior: 'smooth'});
            });

            // Set up IDs for the default pallet input for accessibility
            const firstPalletInput = document.querySelector('#pallet-inputs .pallet-input');
            if (firstPalletInput) {
                const fields = [
                    {label: 'Ê£ßÊùøÈ°ûÂûã:', class: 'pallet-length', value: '110'}, 
                    {label: '', class: 'pallet-width', value: '110'},  
                    {label: 'È´ò(cm):', class: 'pallet-height', value: '100'},
                    {label: 'ÂñÆÈáç(kg):', class: 'pallet-weight', value: '25'},
                    {label: 'Êï∏Èáè:', class: 'pallet-count', value: '1'}
                ];
                fields.forEach(field => {
                    const inputElement = firstPalletInput.querySelector(`.${field.class}`);
                    if (inputElement) {
                        const id = `default-pallet-${field.class}`;
                        inputElement.id = id;
                        // Find the corresponding label element based on its content or position
                        if (field.label) {
                            const labelElement = Array.from(firstPalletInput.querySelectorAll('label'))
                                .find(l => l.textContent.includes(field.label.replace(':', '')));
                            if (labelElement) {
                                labelElement.htmlFor = id;
                            } else {
                                // Fallback: find the closest previous sibling label or create if needed
                                let prevSibling = inputElement.previousElementSibling;
                                while(prevSibling && prevSibling.tagName !== 'LABEL') {
                                    prevSibling = prevSibling.previousElementSibling;
                                }
                                if(prevSibling) {
                                    prevSibling.htmlFor = id;
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
