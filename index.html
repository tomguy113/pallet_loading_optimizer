<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç£è»Šå‹é¸æ“‡è¨ˆç®—å™¨ - æ£§æ¿é…ç½®æœ€ä½³åŒ–</title>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .input-section {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .pallet-input {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .pallet-input label {
            font-weight: bold;
            min-width: 80px;
        }
        
        .pallet-input input {
            padding: 8px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            width: 100px;
        }
        
        .btn {
            background: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: button;
            margin: 5px;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #219a52;
        }
        
        .results {
            margin-top: 30px;
        }
        
        .vehicle-option {
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            transition: all 0.3s;
        }
        
        .vehicle-option.recommended {
            border-color: #27ae60;
            background: #d5f4e6;
        }
        
        .vehicle-option.not-suitable {
            border-color: #e74c3c;
            background: #fdf2f2;
        }
        
        .vehicle-title {
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .specs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .spec-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
        }
        
        .layout-display {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 5px;
            border: 1px solid #ecf0f1;
        }
        
        .pallet-grid {
            display: inline-block;
            margin: 10px;
            padding: 10px;
            border: 2px solid #3498db;
            background: #ebf3fd;
            text-align: center;
            min-width: 60px;
            border-radius: 3px;
        }
        
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        
        .warning {
            color: #f39c12;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš› å°ç£è»Šå‹é¸æ“‡è¨ˆç®—å™¨</h1>
        <p style="text-align: center; color: #7f8c8d;">æ ¹æ“šæ£§æ¿å°ºå¯¸èˆ‡æ•¸é‡ï¼Œæ™ºèƒ½æ¨è–¦æœ€é©åˆçš„è»Šå‹ï¼ˆ3.49å™¸/8.8å™¸/17å™¸ï¼‰</p>
        
        <div class="input-section">
            <h3>æ£§æ¿è³‡è¨Šè¼¸å…¥</h3>
            <div id="pallet-inputs">
                <div class="pallet-input">
                    <label>æ£§æ¿é¡å‹:</label>
                    <input type="number" placeholder="é•·åº¦(cm)" class="pallet-length" value="110">
                    <span>Ã—</span>
                    <input type="number" placeholder="å¯¬åº¦(cm)" class="pallet-width" value="110">
                    <span>cmï¼Œæ•¸é‡:</span>
                    <input type="number" placeholder="æ•¸é‡" class="pallet-count" value="1" min="1">
                    <button class="btn btn-danger" onclick="removePallet(this)">åˆªé™¤</button>
                </div>
            </div>
            
            <div style="margin-top: 15px;">
                <button class="btn" onclick="addPallet()">+ æ–°å¢æ£§æ¿é¡å‹</button>
                <button class="btn" onclick="addCommonPallet('110x110')">å¿«é€Ÿæ–°å¢ 110Ã—110cm</button>
                <button class="btn" onclick="addCommonPallet('120x100')">å¿«é€Ÿæ–°å¢ 120Ã—100cm</button>
                <button class="btn" onclick="addCommonPallet('120x80')">å¿«é€Ÿæ–°å¢ 120Ã—80cm</button>
                <button class="btn btn-success" onclick="calculate()">ğŸ” è¨ˆç®—æœ€ä½³è»Šå‹</button>
            </div>
        </div>
        
        <div class="results" id="results"></div>
    </div>

    <script>
        // è»Šå‹è¦æ ¼å®šç¾©ï¼ˆä¿®æ­£ç‰ˆï¼Œç§»é™¤descriptionï¼‰
        const vehicleSpecs = {
            '3.49å™¸': {
                name: '3.49å™¸ä¸­å‹è²¨è»Š',
                length: 340,
                width: 170,
                height: 160,
                maxWeight: 1500,
                volume: 80
            },
            '8.8å™¸': {
                name: '8.8å™¸è²¨è»Š',
                length: 484,
                width: 196,
                height: 190,
                maxWeight: 5000,
                volume: 600
            },
            '17å™¸': {
                name: '17å™¸å¤§å‹è²¨è»Š',
                length: 859,
                width: 240,
                height: 260,
                maxWeight: 7500,
                volume: 1200
            }
        };

        function addPallet() {
            const container = document.getElementById('pallet-inputs');
            const newPallet = document.createElement('div');
            newPallet.className = 'pallet-input';
            newPallet.innerHTML = `
                <label>æ£§æ¿é¡å‹:</label>
                <input type="number" placeholder="é•·åº¦(cm)" class="pallet-length" value="110">
                <span>Ã—</span>
                <input type="number" placeholder="å¯¬åº¦(cm)" class="pallet-width" value="110">
                <span>cmï¼Œæ•¸é‡:</span>
                <input type="number" placeholder="æ•¸é‡" class="pallet-count" value="1" min="1">
                <button class="btn btn-danger" onclick="removePallet(this)">åˆªé™¤</button>
            `;
            container.appendChild(newPallet);
        }

        function addCommonPallet(size) {
            const [length, width] = size.split('x').map(Number);
            const container = document.getElementById('pallet-inputs');
            const newPallet = document.createElement('div');
            newPallet.className = 'pallet-input';
            newPallet.innerHTML = `
                <label>æ£§æ¿é¡å‹:</label>
                <input type="number" placeholder="é•·åº¦(cm)" class="pallet-length" value="${length}">
                <span>Ã—</span>
                <input type="number" placeholder="å¯¬åº¦(cm)" class="pallet-width" value="${width}">
                <span>cmï¼Œæ•¸é‡:</span>
                <input type="number" placeholder="æ•¸é‡" class="pallet-count" value="1" min="1">
                <button class="btn btn-danger" onclick="removePallet(this)">åˆªé™¤</button>
            `;
            container.appendChild(newPallet);
        }

        function removePallet(button) {
            const container = document.getElementById('pallet-inputs');
            if (container.children.length > 1) {
                button.parentElement.remove();
            } else {
                alert('è‡³å°‘éœ€è¦ä¿ç•™ä¸€å€‹æ£§æ¿é¡å‹ï¼');
            }
        }

        function calculate() {
            const pallets = collectPalletData();
            if (pallets.length === 0) {
                alert('è«‹è‡³å°‘è¼¸å…¥ä¸€ç¨®æ£§æ¿é¡å‹ï¼');
                return;
            }

            const results = [];
            
            for (const [vehicleType, specs] of Object.entries(vehicleSpecs)) {
                const result = calculateVehicleFit(pallets, specs, vehicleType);
                results.push(result);
            }

            displayResults(results, pallets);
        }

        function collectPalletData() {
            const palletInputs = document.querySelectorAll('.pallet-input');
            const pallets = [];

            palletInputs.forEach(input => {
                const length = parseInt(input.querySelector('.pallet-length').value);
                const width = parseInt(input.querySelector('.pallet-width').value);
                const count = parseInt(input.querySelector('.pallet-count').value);

                if (length > 0 && width > 0 && count > 0) {
                    for (let i = 0; i < count; i++) {
                        pallets.push({ length, width, id: pallets.length + i });
                    }
                }
            });

            return pallets;
        }

        function calculateVehicleFit(pallets, vehicleSpecs, vehicleType) {
            const { length: vLength, width: vWidth, maxWeight } = vehicleSpecs;
            
            // å˜—è©¦ä¸åŒçš„æ’åˆ—æ–¹å¼
            const layouts = [];
            
            // æ–¹å¼1ï¼šæŒ‰åŸå§‹æ–¹å‘æ’åˆ—
            layouts.push(packPallets(pallets, vLength, vWidth, false));
            
            // æ–¹å¼2ï¼šå…è¨±90åº¦æ—‹è½‰
            layouts.push(packPallets(pallets, vLength, vWidth, true));

            // é¸æ“‡æœ€ä½³æ’åˆ—æ–¹å¼
            const bestLayout = layouts.reduce((best, current) => 
                current.fittedCount > best.fittedCount ? current : best
            );

            const efficiency = pallets.length > 0 ? (bestLayout.fittedCount / pallets.length * 100) : 0;
            
            let recommendation = '';
            if (efficiency === 100) {
                recommendation = 'recommended';
            } else if (efficiency >= 80) {
                recommendation = 'suitable';
            } else if (efficiency >= 50) {
                recommendation = 'marginal';
            } else {
                recommendation = 'not-suitable';
            }

            return {
                vehicleType,
                specs: vehicleSpecs,
                layout: bestLayout,
                efficiency: efficiency.toFixed(1),
                recommendation,
                totalPallets: pallets.length,
                fittedPallets: bestLayout.fittedCount
            };
        }

        function packPallets(pallets, containerLength, containerWidth, allowRotation) {
            const sortedPallets = [...pallets].sort((a, b) => (b.length * b.width) - (a.length * a.width));
            const placed = [];
            const notFitted = [];
            
            // ä½¿ç”¨ç°¡åŒ–çš„çŸ©å½¢è£ç®±ç®—æ³•
            const occupiedSpaces = [];

            for (const pallet of sortedPallets) {
                let fitted = false;
                const orientations = [
                    { length: pallet.length, width: pallet.width },
                ];
                
                if (allowRotation) {
                    orientations.push({ length: pallet.width, width: pallet.length });
                }

                for (const orientation of orientations) {
                    if (fitted) break;
                    
                    for (let x = 0; x <= containerLength - orientation.length; x += 10) {
                        if (fitted) break;
                        for (let y = 0; y <= containerWidth - orientation.width; y += 10) {
                            const rect = {
                                x, y,
                                x2: x + orientation.length,
                                y2: y + orientation.width
                            };

                            if (!isOverlapping(rect, occupiedSpaces) && 
                                x + orientation.length <= containerLength && 
                                y + orientation.width <= containerWidth) {
                                occupiedSpaces.push(rect);
                                placed.push({
                                    ...pallet,
                                    x, y,
                                    placedLength: orientation.length,
                                    placedWidth: orientation.width,
                                    rotated: orientation.length !== pallet.length
                                });
                                fitted = true;
                                break;
                            }
                        }
                    }
                }

                if (!fitted) {
                    notFitted.push(pallet);
                }
            }

            return {
                placed,
                notFitted,
                fittedCount: placed.length,
                utilization: ((placed.length / pallets.length) * 100).toFixed(1)
            };
        }

        function isOverlapping(rect, occupiedSpaces) {
            for (const occupied of occupiedSpaces) {
                if (!(rect.x2 <= occupied.x || rect.x >= occupied.x2 || 
                      rect.y2 <= occupied.y || rect.y >= occupied.y2)) {
                    return true;
                }
            }
            return false;
        }

        function displayResults(results, allPallets) {
            const resultsDiv = document.getElementById('results');
            
            // æ’åºçµæœï¼šæ¨è–¦çš„æ’åœ¨å‰é¢
            results.sort((a, b) => {
                if (a.recommendation === 'recommended' && b.recommendation !== 'recommended') return -1;
                if (b.recommendation === 'recommended' && a.recommendation !== 'recommended') return 1;
                return b.efficiency - a.efficiency;
            });

            let html = '<h2>ğŸ¯ è»Šå‹æ¨è–¦çµæœ</h2>';
            
            results.forEach(result => {
                const isRecommended = result.recommendation === 'recommended';
                const isNotSuitable = result.recommendation === 'not-suitable';
                
                html += `
                    <div class="vehicle-option ${result.recommendation}">
                        <div class="vehicle-title">
                            ${result.vehicleType} - ${result.specs.name}
                            ${isRecommended ? ' â­ æ¨è–¦' : ''}
                            ${isNotSuitable ? ' âŒ ä¸é©åˆ' : ''}
                        </div>
                        
                        <div class="specs">
                            <div class="spec-item">
                                <strong>è»Šå»‚å°ºå¯¸:</strong><br>
                                ${result.specs.length} Ã— ${result.specs.width} Ã— ${result.specs.height} cm
                            </div>
                            <div class="spec-item">
                                <strong>è¼‰é‡èƒ½åŠ›:</strong><br>
                                ${result.specs.maxWeight} kg
                            </div>
                            <div class="spec-item">
                                <strong>è£è¼‰æ•ˆç‡:</strong><br>
                                <span class="${result.efficiency >= 80 ? 'success' : result.efficiency >= 50 ? 'warning' : 'error'}">
                                    ${result.efficiency}%
                                </span>
                            </div>
                            <div class="spec-item">
                                <strong>æ£§æ¿é…ç½®:</strong><br>
                                ${result.fittedPallets}/${result.totalPallets} å€‹
                            </div>
                        </div>
                        
                        <div class="layout-display">
                            <h4>ğŸ“¦ æ£§æ¿é…ç½®åœ–:</h4>
                            <div style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                                è»Šå»‚: ${result.specs.length}Ã—${result.specs.width}cm
                            </div>
                            ${generateLayoutVisualization(result.layout, result.specs)}
                            
                            ${result.layout.notFitted.length > 0 ? `
                                <div style="margin-top: 15px;">
                                    <span class="error">âš ï¸ ç„¡æ³•è£è¼‰çš„æ£§æ¿: ${result.layout.notFitted.length} å€‹</span>
                                    <div style="font-size: 0.9em; color: #666;">
                                        ${result.layout.notFitted.map(p => `${p.length}Ã—${p.width}cm`).join(', ')}
                                    </div>
                                </div>
                            ` : '<div class="success">âœ… æ‰€æœ‰æ£§æ¿éƒ½èƒ½å®Œç¾è£è¼‰ï¼</div>'}
                        </div>
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        function generateLayoutVisualization(layout, vehicleSpecs) {
            const scale = 0.5; // ç¸®æ”¾æ¯”ä¾‹
            const containerWidth = vehicleSpecs.length * scale;
            const containerHeight = vehicleSpecs.width * scale;
            
            let svg = `
                <svg width="${containerWidth + 50}" height="${containerHeight + 50}" style="border: 2px solid #34495e; background: #ecf0f1;">
                    <rect x="25" y="25" width="${containerWidth}" height="${containerHeight}" 
                          fill="white" stroke="#34495e" stroke-width="2"/>
            `;

            // ç¹ªè£½å·²æ”¾ç½®çš„æ£§æ¿
            layout.placed.forEach((pallet, index) => {
                const x = 25 + pallet.x * scale;
                const y = 25 + pallet.y * scale;
                const width = pallet.placedLength * scale;
                const height = pallet.placedWidth * scale;
                
                const color = `hsl(${(index * 137.5) % 360}, 70%, 80%)`;
                
                svg += `
                    <rect x="${x}" y="${y}" width="${width}" height="${height}" 
                          fill="${color}" stroke="#2c3e50" stroke-width="1" opacity="0.8"/>
                    <text x="${x + width/2}" y="${y + height/2}" 
                          text-anchor="middle" dominant-baseline="middle" 
                          font-size="8" font-weight="bold">
                        ${pallet.length}Ã—${pallet.width}
                        ${pallet.rotated ? 'â†»' : ''}
                    </text>
                `;
            });

            svg += '</svg>';
            
            return svg + `
                <div style="margin-top: 10px; font-size: 0.9em;">
                    <span class="success">âœ… å·²æ”¾ç½®: ${layout.placed.length} å€‹æ£§æ¿</span>
                    ${layout.placed.some(p => p.rotated) ? '<span style="margin-left: 15px;">â†» = å·²æ—‹è½‰90Â°</span>' : ''}
                </div>
            `;
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å¯ä»¥åœ¨é€™è£¡æ·»åŠ é è¨­çš„æ£§æ¿é…ç½®
        });
    </script>
</body>
</html>
